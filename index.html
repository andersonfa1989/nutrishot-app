<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>NutriShot Elements</title>
    <style>
        :root { --primary: #2ab573; --secondary: #6a11cb; --bg: #f8f9fa; --text: #333; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: #fdfdfd; color: var(--text); padding-bottom: 100px; }
        
        /* Headers e Logos */
        .header-main { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .logo-login { width: 180px; display: block; margin: 40px auto 20px; }

        /* Cards Estilizados */
        .card { background: #fff; border-radius: 15px; padding: 20px; margin: 15px 20px; border: 1px solid #eee; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        .card-streak { background: linear-gradient(135deg, #4e54c8, #8f94fb); color: #fff; border: none; }
        
        /* Gr√°fico 7 Dias */
        .chart-container { display: flex; justify-content: space-between; align-items: flex-end; height: 60px; margin-top: 20px; padding: 0 10px; }
        .bar-wrapper { display: flex; flex-direction: column; align-items: center; flex: 1; }
        .bar-value { font-size: 10px; color: #aaa; margin-bottom: 5px; }
        .bar-fill { width: 30px; height: 4px; background: #eee; border-radius: 2px; }
        .bar-fill.active { background: var(--secondary); }
        .bar-date { font-size: 10px; color: #ccc; margin-top: 5px; }

        /* Grid de Macros */
        .grid-macros { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 0 20px; }
        .macro-box { background: #fff; padding: 20px 10px; border-radius: 15px; border: 1px solid #eee; text-align: center; }
        .macro-box small { color: #888; font-size: 11px; display: block; margin-bottom: 8px; }
        .macro-box b { font-size: 18px; }

        /* Conquistas */
        .achievement-item { display: flex; align-items: center; background: #f4f6f9; padding: 12px; border-radius: 12px; margin-top: 10px; }
        .achievement-icon { width: 40px; height: 40px; background: #fff; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 20px; }

        /* Bot√µes e FAB */
        .btn-green { background: var(--primary); color: #fff; border: none; width: calc(100% - 40px); margin: 10px 20px; padding: 16px; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-black { background: #111; color: #fff; border: none; padding: 18px; border-radius: 30px; width: calc(100% - 40px); margin: 10px 20px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .fab { position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 32px; border: none; box-shadow: 0 4px 20px rgba(0,0,0,0.4); z-index: 999; }

        /* Overlay An√∫ncio */
        .overlay-ads { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        .progress-ads { width: 70%; height: 6px; background: #333; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        #bar-ads { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s linear; }

        /* Inputs */
        .input-field { width: calc(100% - 40px); margin: 10px 20px; padding: 15px; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
    </style>
</head>
<body>

    <div id="overlay-ads" class="overlay-ads">
        <div style="font-size: 18px; font-weight: bold;">Carregando Conte√∫do...</div>
        <div class="progress-ads"><div id="bar-ads"></div></div>
        <div style="font-size: 12px; color: #888;">Aguarde o t√©rmino do v√≠deo</div>
    </div>

    <div id="app"></div>

    <script>
        // ESTADO DO APLICATIVO COM PERSIST√äNCIA
        let state = JSON.parse(localStorage.getItem('nutrishot_pro_session')) || {
            screen: 'login',
            isLogged: false,
            calories: 0, protein: 0, carbs: 0, fat: 0,
            meals: [],
            hasAchievement: false
        };

        function saveState() { localStorage.setItem('nutrishot_pro_session', JSON.stringify(state)); }

        function navigate(screen) { state.screen = screen; render(); window.scrollTo(0,0); }

        function runAd(callback) {
            const overlay = document.getElementById('overlay-ads');
            const bar = document.getElementById('bar-ads');
            overlay.style.display = 'flex';
            let p = 0;
            const interval = setInterval(() => {
                p += 4; bar.style.width = p + '%';
                if(p >= 100) { clearInterval(interval); overlay.style.display = 'none'; bar.style.width = '0%'; callback(); }
            }, 80);
        }

        function handlePhoto(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                state.tempImg = e.target.result;
                navigate('confirm_photo');
            };
            reader.readAsDataURL(input.files[0]);
        }

        function calculateIA() {
            runAd(() => {
                const cal = Math.floor(Math.random() * 200 + 400);
                const p = Math.floor(cal * 0.05);
                const c = Math.floor(cal * 0.11);
                const g = Math.floor(cal * 0.03);

                state.calories += cal;
                state.protein += p;
                state.carbs += c;
                state.fat += g;
                state.meals.unshift({ name: 'Refei√ß√£o', cal: cal });
                state.hasAchievement = true;
                
                saveState();
                navigate('home');
            });
        }

        function render() {
            const root = document.getElementById('app');
            
            // TELA DE LOGIN
            if (state.screen === 'login') {
                root.innerHTML = `
                    <img src="https://i.ibb.co/Lz0D7Yd/icone-512.png" class="logo-login">
                    <input type="email" class="input-field" placeholder="E-mail">
                    <input type="password" class="input-field" placeholder="Senha">
                    <button class="btn-black" onclick="state.isLogged=true; navigate('home')">Entrar</button>
                    <p style="text-align:center; font-size:14px; color:#888;">Esqueceu a senha? | <b onclick="navigate('register')" style="color:var(--primary)">Cadastre-se</b></p>
                `;
            }

            // DASHBOARD COMPLETO
            else if (state.screen === 'home') {
                root.innerHTML = `
                    <div class="header-main">
                        <div><b>Ol√°, Isaac!</b><br><small style="color:#888;">Resumo de hoje</small></div>
                        <button onclick="localStorage.clear(); location.reload()" style="background:#eee; border:none; padding:5px 15px; border-radius:8px;">Sair</button>
                    </div>

                    <div class="card card-streak">
                        <small>Fogo na Sequ√™ncia</small>
                        <div style="font-size: 40px; font-weight: bold; margin-top:5px;">1 üî•</div>
                    </div>

                    <div class="card">
                        <b>√öltimos 7 Dias</b>
                        <div class="chart-container">
                            ${['9/1','10/1','11/1','12/1','13/1','14/1','15/1'].map((d, i) => `
                                <div class="bar-wrapper">
                                    <span class="bar-value">${i === 5 ? '400' : '0'}</span>
                                    <div class="bar-fill ${i === 5 ? 'active' : ''}"></div>
                                    <span class="bar-date">${d}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <button class="btn-green" onclick="navigate('store')">üõí VER SUPLEMENTOS RECOMENDADOS</button>

                    <div class="card">
                        <small style="color:#888">Calorias Consumidas</small>
                        <div style="font-size: 26px; font-weight: bold; margin: 5px 0;">${state.calories} <span style="font-size:14px; color:#ccc; font-weight:normal;">/ 2577 cal</span></div>
                        <div style="width:100%; height:8px; background:#f0f0f0; border-radius:10px;">
                            <div style="width:${Math.min((state.calories/2577)*100, 100)}%; height:100%; background:var(--primary); border-radius:10px;"></div>
                        </div>
                    </div>

                    <div class="grid-macros">
                        <div class="macro-box"><small>Prote√≠na</small><b>${state.protein}g</b></div>
                        <div class="macro-box"><small>Carboidratos</small><b>${state.carbs}g</b></div>
                        <div class="macro-box"><small>Gordura</small><b>${state.fat}g</b></div>
                    </div>

                    <div class="card" style="border: 1px solid var(--primary); background: #fafffb;">
                        <b style="color:var(--primary)">Dica Especial</b><br>
                        <small style="color:#666">Assista ao v√≠deo e libere uma dica nutricional!</small>
                        <button class="btn-green" style="width:100%; margin:15px 0 0 0" onclick="runAd(()=>navigate('dica'))">üì∫ Assistir An√∫ncio</button>
                    </div>

                    <div class="card">
                        <b>Conquistas Desbloqueadas</b>
                        ${state.hasAchievement ? `
                            <div class="achievement-item">
                                <div class="achievement-icon">üèÜ</div>
                                <div><b>Primeira Refei√ß√£o</b><br><small style="color:#888">Registrou sua primeira refei√ß√£o</small></div>
                            </div>
                        ` : `<p style="color:#ccc; text-align:center; font-size:14px; margin-top:15px;">Nenhuma conquista ainda.</p>`}
                    </div>

                    <div class="card">
                        <b>Refei√ß√µes de Hoje</b>
                        <div style="margin-top:15px;">
                            ${state.meals.length === 0 ? '<p style="color:#ccc; text-align:center; font-size:14px;">Nenhuma refei√ß√£o registrada ainda.</p>' : 
                                state.meals.map(m => `<div style="display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid #f9f9f9"><span>Refei√ß√£o</span><b>+${m.cal} kcal</b></div>`).join('')
                            }
                        </div>
                    </div>

                    <button class="fab" onclick="navigate('add_meal')">+</button>
                `;
            }

            // TELA DE ADICIONAR
            else if (state.screen === 'add_meal') {
                root.innerHTML = `
                    <div style="padding:20px">
                        <h2 onclick="navigate('home')">‚Üê Voltar</h2>
                        <div class="card" style="text-align:center; padding:40px 20px;">
                            <p><b>Como deseja registrar?</b></p>
                            <button class="btn-black" style="width:100%; margin:10px 0" onclick="document.getElementById('c-in').click()">üì∏ Tirar Foto</button>
                            <button class="btn-black" style="width:100%; margin:0; background:#fff; color:#000; border:1px solid #ddd" onclick="document.getElementById('g-in').click()">üìÅ Galeria</button>
                        </div>
                        <input type="file" id="c-in" capture="environment" accept="image/*" style="display:none" onchange="handlePhoto(this)">
                        <input type="file" id="g-in" accept="image/*" style="display:none" onchange="handlePhoto(this)">
                    </div>
                `;
            }

            else if (state.screen === 'confirm_photo') {
                root.innerHTML = `
                    <div style="padding:20px; text-align:center">
                        <img src="${state.tempImg}" style="width:100%; border-radius:20px; margin-bottom:20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1)">
                        <button class="btn-black" onclick="calculateIA()">Calcular com IA</button>
                        <p onclick="navigate('add_meal')" style="color:red; margin-top:20px">Trocar Foto</p>
                    </div>
                `;
            }

            // TELA DE DICA FINAL
            else if (state.screen === 'dica') {
                root.innerHTML = `
                    <div style="min-height:100vh; background:linear-gradient(180deg, #e8f5e9, #fff); padding:60px 20px; text-align:center">
                        <img src="https://i.ibb.co/Lz0D7Yd/icone-512.png" style="width:60px; margin-bottom:20px;">
                        <h1 style="color:var(--primary); margin:0">Dica Liberada!</h1>
                        <div class="card" style="padding:40px 20px; margin-top:30px; line-height:1.6; font-size:18px;">
                            "Comer fibras (como saladas) antes do prato principal reduz o pico de insulina e ajuda a controlar o peso!"
                        </div>
                        <button class="btn-black" onclick="navigate('home')" style="margin-top:30px">Voltar ao Dashboard</button>
                    </div>
                `;
            }
        }

        render();
    </script>
</body>
</html>
