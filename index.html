<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>NutriShot Elements</title>
    <style>
        :root { --primary: #2ab573; --secondary: #6a11cb; --bg: #f8f9fa; --text: #333; }
        body { margin: 0; font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); padding-bottom: 80px; }
        
        /* Layout Geral */
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .logo-main { width: 140px; display: block; margin: 20px auto; }
        .card { background: #fff; border-radius: 15px; padding: 20px; margin: 10px 20px; border: 1px solid #eee; }
        
        /* Dashboard */
        .card-streak { background: linear-gradient(135deg, #4e54c8, #8f94fb); color: #fff; border: none; }
        .grid-7days { display: flex; justify-content: space-between; align-items: flex-end; height: 40px; margin-top: 15px; padding: 0 10px; }
        .bar-day { width: 8px; background: #eee; border-radius: 4px; position: relative; }
        .bar-active { background: var(--secondary); height: 60%; }
        
        /* Macros */
        .grid-macros { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 0 20px; }
        .macro-box { background: #fff; padding: 15px; border-radius: 15px; border: 1px solid #eee; text-align: center; }
        .macro-box small { color: #888; font-size: 11px; display: block; margin-bottom: 4px; }

        /* Bot√µes */
        .btn-green { background: var(--primary); color: #fff; border: none; width: calc(100% - 40px); margin: 10px 20px; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        .btn-black { background: #111; color: #fff; border: none; padding: 18px; border-radius: 30px; width: calc(100% - 50px); margin: 10px 25px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .fab { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: #000; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1000; }

        /* Overlays */
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; flex-direction: column; align-items: center; justify-content: center; color: white; text-align: center; }
        #ai-loader { background: rgba(255,255,255,0.95); color: #333; }
        .progress-container { width: 70%; height: 6px; background: #333; border-radius: 10px; margin: 20px 0; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: var(--primary); transition: width 0.1s linear; }

        /* Inputs */
        .input-group { margin: 10px 25px; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ddd; box-sizing: border-box; }
        
        .meal-option { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 20px; margin-bottom: 10px; text-align: center; cursor: pointer; }
        .meal-option.active { background: #111; color: #fff; }
    </style>
</head>
<body>

    <div id="loading-overlay" class="overlay">
        <div style="font-size: 18px; font-weight: bold;">Carregando Dica Especial...</div>
        <div class="progress-container"><div id="progress-bar"></div></div>
        <div style="font-size: 12px; color: #888;">Assista para liberar</div>
    </div>

    <div id="ai-loader" class="overlay">
        <div style="font-size: 50px;">ü§ñ</div>
        <div style="font-weight: bold; margin-top: 15px;">IA Analisando sua Refei√ß√£o...</div>
    </div>

    <div id="app"></div>

    <script>
        // ESTADO GLOBAL DO APP
        let estado = JSON.parse(localStorage.getItem('nutri_session')) || {
            tela: 'login',
            logado: false,
            calorias: 0, proteina: 0, carbos: 0, gordura: 0,
            refeicoes: [],
            tempImg: null,
            tipoRefeicao: 'Almo√ßo'
        };

        function salvar() { localStorage.setItem('nutri_session', JSON.stringify(estado)); }

        function navegar(tela) { estado.tela = tela; render(); window.scrollTo(0,0); }

        function logout() {
            localStorage.removeItem('nutri_session');
            location.reload();
        }

        // SISTEMA DE AN√öNCIO
        function rodarAnuncio(callback) {
            const overlay = document.getElementById('loading-overlay');
            const bar = document.getElementById('progress-bar');
            overlay.style.display = 'flex';
            let p = 0;
            const int = setInterval(() => {
                p += 2; bar.style.width = p + '%';
                if(p >= 100) { clearInterval(int); overlay.style.display = 'none'; bar.style.width = '0%'; callback(); }
            }, 40);
        }

        // ANALISE DE IA E SOMA
        function finalizarCaptura(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                estado.tempImg = e.target.result;
                navegar('confirmar_foto');
            };
            reader.readAsDataURL(input.files[0]);
        }

        function calcularRefeicaoIA() {
            document.getElementById('ai-loader').style.display = 'flex';
            setTimeout(() => {
                const calGerada = Math.floor(Math.random() * 250 + 350);
                const p = Math.floor(calGerada * 0.06);
                const c = Math.floor(calGerada * 0.12);
                const g = Math.floor(calGerada * 0.03);

                estado.calorias += calGerada;
                estado.proteina += p;
                estado.carbos += c;
                estado.gordura += g;
                estado.refeicoes.unshift({ nome: estado.tipoRefeicao, cal: calGerada });
                
                document.getElementById('ai-loader').style.display = 'none';
                salvar();
                
                // Exibe resultado detalhado antes de voltar
                root.innerHTML = `
                    <div style="padding:40px 20px; text-align:center;">
                        <img src="${estado.tempImg}" style="width:200px; border-radius:20px; margin-bottom:20px;">
                        <h2 style="color:var(--primary)">An√°lise Conclu√≠da!</h2>
                        <div class="card">
                            <p><b>${estado.tipoRefeicao}</b></p>
                            <p style="font-size:24px; font-weight:bold;">${calGerada} kcal</p>
                            <hr border="0" height="1" background="#eee">
                            <p>P: ${p}g | C: ${c}g | G: ${g}g</p>
                        </div>
                        <button class="btn-black" onclick="navegar('home')">Confirmar e Voltar</button>
                    </div>
                `;
            }, 2000);
        }

        function render() {
            const root = document.getElementById('app');
            
            if (estado.tela === 'login') {
                root.innerHTML = `
                    <img src="https://i.ibb.co/Lz0D7Yd/icone-512.png" class="logo-main">
                    <div class="input-group"><input type="email" placeholder="E-mail"></div>
                    <div class="input-group"><input type="password" placeholder="Senha"></div>
                    <button class="btn-black" onclick="estado.logado=true; navegar('home')">Entrar</button>
                    <p style="text-align:center; font-size:14px;">Novo aqui? <b onclick="navegar('cadastro')">Cadastre-se</b></p>
                `;
            }

            else if (estado.tela === 'cadastro') {
                root.innerHTML = `
                    <img src="https://i.ibb.co/Lz0D7Yd/icone-512.png" class="logo-main" style="width:80px">
                    <h2 style="text-align:center">Criar Conta</h2>
                    <div class="input-group"><input type="text" placeholder="Nome"></div>
                    <div class="input-group"><input type="email" placeholder="E-mail"></div>
                    <div class="input-group"><input type="password" placeholder="Senha"></div>
                    <button class="btn-black" onclick="navegar('login')">Registrar</button>
                `;
            }

            else if (estado.tela === 'home') {
                root.innerHTML = `
                    <div class="header">
                        <div><b>Ol√°, Isaac!</b><br><small style="color:#888;">Bem-vindo de volta</small></div>
                        <button onclick="logout()" style="background:none; border:none; color:#888;">Sair</button>
                    </div>

                    <div class="card card-streak">
                        <small>Fogo na Sequ√™ncia</small>
                        <div style="font-size: 35px; font-weight: bold;">1 üî•</div>
                        <div class="grid-7days">
                            ${[1,2,3,4,5,6,7].map(i => `<div class="bar-day ${i===6?'bar-active':''}" style="height:${i*10}%"></div>`).join('')}
                        </div>
                    </div>

                    <button class="btn-green" onclick="navegar('loja')">üõí VER SUPLEMENTOS RECOMENDADOS</button>

                    <div class="card">
                        <small style="color:#888">Calorias Consumidas</small>
                        <div style="font-size: 24px; font-weight: bold; margin: 5px 0;">${estado.calorias} <span style="font-size:14px; color:#ccc">/ 2577 cal</span></div>
                        <div style="width:100%; height:6px; background:#f0f0f0; border-radius:10px;">
                            <div style="width:${(estado.calorias/2577)*100}%; height:100%; background:var(--primary); border-radius:10px;"></div>
                        </div>
                    </div>

                    <div class="grid-macros">
                        <div class="macro-box"><small>Prote√≠na</small><b>${estado.proteina}g</b></div>
                        <div class="macro-box"><small>Carbos</small><b>${estado.carbos}g</b></div>
                        <div class="macro-box"><small>Gordura</small><b>${estado.gordura}g</b></div>
                    </div>

                    <div class="card" style="border:1px solid var(--primary); background:#fafffb">
                        <b style="color:var(--primary)">Dica Especial</b>
                        <button class="btn-green" style="width:100%; margin:10px 0 0 0" onclick="rodarAnuncio(()=>navegar('dica'))">üí° Ver aqui a dica especial</button>
                    </div>

                    <div class="card">
                        <b>Refei√ß√µes de Hoje</b>
                        <div style="margin-top:10px">
                            ${estado.refeicoes.map(r => `<div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f9f9f9"><span>${r.nome}</span><b>+${r.cal} kcal</b></div>`).join('')}
                        </div>
                    </div>

                    <button class="fab" onclick="navegar('add')">+</button>
                `;
            }

            else if (estado.tela === 'add') {
                root.innerHTML = `
                    <div style="padding:20px">
                        <h2 onclick="navegar('home')">‚Üê Voltar</h2>
                        <p><b>Tipo de Refei√ß√£o</b></p>
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
                            ${['Caf√©','Almo√ßo','Jantar','Lanche'].map(t => `<div class="meal-option ${estado.tipoRefeicao===t?'active':''}" onclick="estado.tipoRefeicao='${t}'; render()">${t}</div>`).join('')}
                        </div>
                        <button class="btn-black" style="width:100%; margin:20px 0" onclick="document.getElementById('cam').click()">üì∏ Abrir C√¢mera</button>
                        <button class="btn-black" style="width:100%; margin:0; background:#fff; color:#333; border:1px solid #ddd" onclick="document.getElementById('gal').click()">üìÅ Escolher da Galeria</button>
                        <input type="file" id="cam" capture="environment" accept="image/*" style="display:none" onchange="finalizarCaptura(this)">
                        <input type="file" id="gal" accept="image/*" style="display:none" onchange="finalizarCaptura(this)">
                    </div>
                `;
            }

            else if (estado.tela === 'confirmar_foto') {
                root.innerHTML = `
                    <div style="padding:20px; text-align:center">
                        <img src="${estado.tempImg}" style="width:100%; border-radius:20px; margin-bottom:20px">
                        <button class="btn-black" onclick="rodarAnuncio(calcularRefeicaoIA)">Calcular com IA</button>
                        <button onclick="navegar('add')" style="background:none; border:none; color:red; margin-top:10px">Trocar Foto</button>
                    </div>
                `;
            }

            else if (estado.tela === 'dica') {
                root.innerHTML = `
                    <div style="min-height:100vh; background:linear-gradient(180deg, #e8f5e9, #fff); padding:40px 20px; text-align:center">
                        <img src="https://i.ibb.co/Lz0D7Yd/icone-512.png" style="width:60px">
                        <h2 style="color:var(--primary)">Dica Liberada!</h2>
                        <div class="card" style="padding:40px 20px; font-size:18px">
                            "Comer fibras antes do prato principal reduz o pico de insulina e ajuda a emagrecer!"
                        </div>
                        <button class="btn-black" onclick="navegar('home')">Voltar ao Dashboard</button>
                    </div>
                `;
            }

            else if (estado.tela === 'loja') {
                root.innerHTML = `
                    <div style="padding:20px">
                        <h2 onclick="navegar('home')">‚Üê Loja</h2>
                        <div class="card">Em breve os produtos aqui...</div>
                    </div>
                `;
            }
        }

        render();
    </script>
</body>
</html>
