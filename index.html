<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NutriShot</title>

<style>
:root {
  --primary:#2ab573;
}
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:#f6f7fb;
}
.card {
  background:#fff;
  padding:20px;
  border-radius:15px;
  margin-bottom:15px;
}
button {
  cursor:pointer;
}
footer {
  position:fixed;
  bottom:0;
  width:100%;
  height:60px;
}
</style>
</head>

<body>
<div id="app"></div>

<footer id="banner-ad"></footer>

<script>
/* =========================
   ESTADO GLOBAL
========================= */
let estado = JSON.parse(localStorage.getItem("estadoNutri")) || {
    tela: "home",
    calorias: 0,
    prot: 0,
    carb: 0,
    gord: 0,
    historico: [],
    semana: [0,0,0,0,0,0,0],
    ultimoDia: new Date().toDateString(),
    tempRefeicao: "",
    ultimoResultado: null
};

/* =========================
   SALVAR
========================= */
function salvar() {
    localStorage.setItem("estadoNutri", JSON.stringify(estado));
}

/* =========================
   RESET DI√ÅRIO + SEMANAL
========================= */
function verificarNovoDia() {
    const hoje = new Date().toDateString();

    if (estado.ultimoDia !== hoje) {
        const diaSemana = new Date().getDay();
        estado.semana[diaSemana] = estado.calorias;

        estado.calorias = 0;
        estado.prot = 0;
        estado.carb = 0;
        estado.gord = 0;
        estado.historico = [];
        estado.ultimoDia = hoje;

        salvar();
    }
}

/* =========================
   NAVEGA√á√ÉO
========================= */
function navegar(tela) {
    estado.tela = tela;
    salvar();
    render();
}

/* =========================
   PROGRESSO SEMANAL (kcal)
========================= */
function progressoSemanal() {
    const total = estado.semana.reduce((a,b)=>a+b,0);
    return Math.min((total / 14000) * 100, 100);
}

/* =========================
   RENDER PRINCIPAL
========================= */
function render() {
    verificarNovoDia();
    const app = document.getElementById("app");

    /* ===== HOME ===== */
    if (estado.tela === "home") {
        app.innerHTML = `
        <div style="padding:20px; padding-bottom:80px">
            <h2>üî• ${estado.calorias} kcal hoje</h2>

            <div class="card">
                <b>Progresso semanal</b>
                <div style="height:15px; background:#eee; border-radius:10px; margin-top:10px">
                    <div style="height:15px; width:${progressoSemanal()}%;
                         background:linear-gradient(to right,#2ab573,#4facfe);
                         border-radius:10px"></div>
                </div>
            </div>

            <button onclick="mostrarIntersticial(); navegar('add_refeicao')"
                style="padding:15px; width:100%; background:var(--primary);
                color:#fff; border:none; border-radius:25px; font-weight:bold">
                ‚ûï Adicionar Refei√ß√£o
            </button>

            <button onclick="mostrarRecompensado()"
                style="margin-top:15px; padding:15px; width:100%;
                background:#667eea; color:#fff; border:none; border-radius:25px">
                üéÅ Dica Premium
            </button>
        </div>`;
        return;
    }
}
</script>
<script>
/* =========================
   ADMOB CONFIG
========================= */
document.addEventListener("deviceready", () => {

    if (!window.admob) {
        console.warn("AdMob n√£o dispon√≠vel");
        return;
    }

    admob.start();

    admob.banner.show({
        adId: "ca-app-pub-6941311170472131/2257554053",
        position: "bottom"
    });

    admob.interstitial.load({
        adId: "ca-app-pub-6941311170472131/2273031775"
    });

    admob.rewarded.load({
        adId: "ca-app-pub-6941311170472131/4221550021"
    });

});

/* =========================
   ADS FUN√á√ïES
========================= */
function mostrarIntersticial() {
    if (window.admob) {
        admob.interstitial.show();
    }
}

function mostrarRecompensado() {
    if (window.admob) {
        admob.rewarded.show();
    }
}

/* =========================
   TELAS
========================= */
function render() {
    verificarNovoDia();
    const app = document.getElementById("app");

    /* ===== HOME ===== */
    if (estado.tela === "home") {
        app.innerHTML = `
        <div style="padding:20px; padding-bottom:80px">
            <h2>üî• ${estado.calorias} kcal hoje</h2>

            <div class="card">
                <b>Progresso semanal</b>
                <div style="height:15px; background:#eee; border-radius:10px; margin-top:10px">
                    <div style="height:15px; width:${progressoSemanal()}%;
                         background:linear-gradient(to right,#2ab573,#4facfe);
                         border-radius:10px"></div>
                </div>
            </div>

            <button onclick="mostrarIntersticial(); navegar('add_refeicao')"
                style="padding:15px; width:100%; background:#2ab573;
                color:#fff; border:none; border-radius:25px; font-weight:bold">
                ‚ûï Adicionar Refei√ß√£o
            </button>

            <button onclick="mostrarRecompensado(); alert('Dica premium liberada!')"
                style="margin-top:15px; padding:15px; width:100%;
                background:#667eea; color:#fff; border:none; border-radius:25px">
                üéÅ Dica Premium
            </button>
        </div>`;
        return;
    }

    /* ===== ADICIONAR REFEI√á√ÉO ===== */
    if (estado.tela === "add_refeicao") {
        app.innerHTML = `
        <div style="padding:20px">
            <h3>Adicionar refei√ß√£o</h3>

            <input id="kcal" type="number" placeholder="Calorias"
                style="width:100%; padding:15px; margin-bottom:10px">

            <button onclick="salvarRefeicao()"
                style="padding:15px; width:100%; background:#2ab573;
                color:#fff; border:none; border-radius:25px">
                Salvar
            </button>

            <button onclick="navegar('home')"
                style="margin-top:10px; padding:10px; width:100%">
                Voltar
            </button>
        </div>`;
        return;
    }
}

/* =========================
   SALVAR REFEI√á√ÉO
========================= */
function salvarRefeicao() {
    const kcal = Number(document.getElementById("kcal").value);

    if (!kcal || kcal <= 0) {
        alert("Informe as calorias");
        return;
    }

    estado.calorias += kcal;
    estado.historico.push({
        kcal,
        data: new Date().toLocaleString()
    });

    salvar();
    navegar("home");
}

/* =========================
   START
========================= */
render();
</script>
<script>
/* =========================
   DICA DI√ÅRIA
========================= */
const dicas = [
    "Beba pelo menos 2L de √°gua por dia üíß",
    "Inclua prote√≠nas em todas as refei√ß√µes üçó",
    "Evite bebidas a√ßucaradas ü•§",
    "Prefira alimentos naturais ü•¶",
    "Dormir bem ajuda no emagrecimento üò¥"
];

function mostrarDicaDiaria() {
    const dia = new Date().getDate();
    alert("üí° Dica do dia:\n\n" + dicas[dia % dicas.length]);
}

/* =========================
   AN√ÅLISE DE IMAGEM (SIMULADA)
========================= */
function analisarImagem() {
    mostrarIntersticial();

    setTimeout(() => {
        const kcalEstimadas = Math.floor(Math.random() * 400) + 200;

        estado.calorias += kcalEstimadas;
        estado.historico.push({
            kcal: kcalEstimadas,
            origem: "Imagem",
            data: new Date().toLocaleString()
        });

        salvar();
        alert(`üì∏ An√°lise conclu√≠da!\nEstimativa: ${kcalEstimadas} kcal`);
        render();
    }, 1000);
}

/* =========================
   MENU PRINCIPAL
========================= */
function menuInferior() {
    return `
    <div style="
        position:fixed;
        bottom:60px;
        left:0;
        width:100%;
        display:flex;
        justify-content:space-around;
        background:#fff;
        padding:10px 0;
        border-top:1px solid #ddd">

        <button onclick="navegar('home')">üè†</button>
        <button onclick="mostrarDicaDiaria()">üí°</button>
        <button onclick="analisarImagem()">üì∏</button>
        <button onclick="navegar('add_refeicao')">‚ûï</button>
    </div>
    `;
}

/* =========================
   SOBRESCREVE RENDER (FINAL)
========================= */
const renderOriginal = render;

render = function() {
    renderOriginal();
    document.body.insertAdjacentHTML("beforeend", menuInferior());
};

/* =========================
   PROTE√á√ÉO DE ERRO GLOBAL
========================= */
window.onerror = function(msg, url, line) {
    console.error("Erro:", msg, "linha:", line);
    alert("‚ö†Ô∏è Ocorreu um erro inesperado, reinicie o app.");
};
</script>

</body>
</html>
