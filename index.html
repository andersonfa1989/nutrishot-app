<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>NutriShot Pro</title>
    <style>
        :root { --primary: #2ab573; --blue: #2490eb; --bg: #f8f9fa; --dark: #212529; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #333; padding-bottom: 100px; }
        
        /* Menu Lateral */
        .sidebar { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: #fff; z-index: 10000; transition: 0.3s; padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.1); }
        .sidebar.active { left: 0; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: none; }

        /* Login e Cadastro */
        .auth-container { padding: 40px 25px; text-align: center; background: #fff; min-height: 100vh; }
        .logo-text { font-size: 32px; font-weight: 800; color: var(--primary); margin-bottom: 30px; letter-spacing: -1px; }
        .input-nutri { width: 100%; padding: 16px; margin: 8px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; box-sizing: border-box; }

        /* Dashboard */
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: #fff; border-bottom: 1px solid #eee; }
        .card { background: #fff; border-radius: 18px; padding: 20px; margin: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .card-summary { background: var(--dark); color: #fff; }
        
        /* Progress Bar */
        .progress-container { width: 100%; height: 10px; background: #eee; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); transition: 0.5s; width: 0%; }

        /* Macronutrientes */
        .macro-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 0 15px; }
        .macro-box { background: #fff; padding: 12px; border-radius: 12px; text-align: center; border: 1px solid #eee; }

        /* FAB - Bot√£o Flutuante */
        .fab { position: fixed; bottom: 90px; right: 20px; width: 65px; height: 65px; background: var(--primary); color: white; border-radius: 50%; border: none; font-size: 30px; box-shadow: 0 4px 15px rgba(42, 181, 115, 0.4); z-index: 999; cursor: pointer; }

        /* An√∫ncio Fixo no Rodap√© */
        .footer-ad { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background: #fff; border-top: 1px solid #ddd; display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 5px; }
        .ad-banner { width: 95%; height: 50px; background: #eee; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; }

        /* Tela de IA / An√∫ncio de Carregamento */
        .ia-loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
        
        .btn-main { width: 100%; background: var(--blue); color: white; border: none; padding: 18px; border-radius: 15px; font-weight: bold; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div id="sidebar" class="sidebar">
        <h2 class="logo-text">NutriShot</h2>
        <p onclick="navegar('home')">üè† Dashboard</p>
        <p onclick="navegar('catalogo')">üõí Suplementos</p>
        <hr>
        <p style="color:red" onclick="sair()">üö™ Sair</p>
    </div>

    <div id="ia-loading" class="ia-loading">
        <p id="ia-text">IA ANALISANDO CALORIAS...</p>
        <div class="progress-container" style="width: 70%;"><div id="ia-bar" class="progress-fill"></div></div>
    </div>

    <div id="app"></div>

    <div class="footer-ad" id="footer-ad">
        <div class="ad-banner">AN√öNCIO: Whey Protein em oferta na Growth!</div>
    </div>

    <script>
        let state = JSON.parse(localStorage.getItem('nutri_v12')) || {
            isLogged: false, page: 'login', user: 'Usu√°rio', weight: 70, height: 170,
            kcal: 0, prot: 0, carb: 0, fat: 0, photo: null, history: []
        };

        function save() { localStorage.setItem('nutri_v12', JSON.stringify(state)); }
        function navegar(p) { state.page = p; render(); toggleSidebar(false); window.scrollTo(0,0); }
        function toggleSidebar(force) {
            const s = document.getElementById('sidebar');
            const o = document.getElementById('overlay');
            if(force === false) { s.classList.remove('active'); o.style.display='none'; return; }
            s.classList.toggle('active');
            o.style.display = s.classList.contains('active') ? 'block' : 'none';
        }

        function handleFile(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (event) => { state.photo = event.target.result; render(); };
                reader.readAsDataURL(file);
            }
        }

        function runIA() {
            const load = document.getElementById('ia-loading');
            const bar = document.getElementById('ia-bar');
            load.style.display = 'flex';
            let p = 0;
            const interval = setInterval(() => {
                p += 5; bar.style.width = p + '%';
                if(p >= 100) {
                    clearInterval(interval);
                    load.style.display = 'none';
                    bar.style.width = '0%';
                    // Resultado Simulado
                    const c = Math.floor(Math.random() * 200 + 350);
                    state.kcal += c;
                    state.prot += 25; state.carb += 40; state.fat += 12;
                    state.history.unshift({ kcal: c, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
                    state.photo = null;
                    state.lastKcal = c;
                    save();
                    navegar('dica');
                }
            }, 100);
        }

        function render() {
            const app = document.getElementById('app');
            const footer = document.getElementById('footer-ad');
            
            // Controle de exibi√ß√£o do an√∫ncio no rodap√©
            footer.style.display = state.isLogged ? 'flex' : 'none';

            if (!state.isLogged) {
                const isReg = state.page === 'cadastro';
                app.innerHTML = `
                    <div class="auth-container">
                        <h1 class="logo-text">NutriShot</h1>
                        <p>${isReg ? 'Crie sua conta gr√°tis' : 'Bem-vindo de volta'}</p>
                        ${isReg ? '<input type="text" id="reg-name" class="input-nutri" placeholder="Nome Completo">' : ''}
                        <input type="email" class="input-nutri" placeholder="E-mail">
                        <input type="password" class="input-nutri" placeholder="Senha">
                        <button class="btn-main" style="margin-top:20px" onclick="login(${isReg})">${isReg ? 'CADASTRAR' : 'ENTRAR'}</button>
                        <p style="margin-top:20px" onclick="navegar('${isReg ? 'login' : 'cadastro'}')">
                            ${isReg ? 'J√° tem conta? <b>Login</b>' : 'N√£o tem conta? <b>Cadastre-se</b>'}
                        </p>
                    </div>`;
                return;
            }

            if (state.page === 'home') {
                app.innerHTML = `
                    <div class="header">
                        <span style="font-size:24px" onclick="toggleSidebar()">‚ò∞</span>
                        <b>NutriShot Elements</b>
                        <div style="width:24px"></div>
                    </div>

                    <div class="card card-summary">
                        <small>Meta Di√°ria</small>
                        <h2 style="margin:5px 0">${state.kcal} / 2500 kcal</h2>
                        <div class="progress-container"><div class="progress-fill" style="width: ${(state.kcal/2500)*100}%"></div></div>
                    </div>

                    <div class="macro-row">
                        <div class="macro-box"><small>Prot</small><br><b>${state.prot}g</b></div>
                        <div class="macro-box"><small>Carb</small><br><b>${state.carb}g</b></div>
                        <div class="macro-box"><small>Gord</small><br><b>${state.fat}g</b></div>
                    </div>

                    <div class="card">
                        <b>Refei√ß√µes de Hoje</b>
                        <div style="margin-top:15px">
                            ${state.history.length === 0 ? '<p style="color:#999; font-size:14px">Nenhuma refei√ß√£o registrada.</p>' : 
                            state.history.map(h => `<div style="display:flex; justify-content:space-between; padding:10px 0; border-bottom:1px solid #f5f5f5"><span>Refei√ß√£o (${h.time})</span><b>${h.kcal} kcal</b></div>`).join('')}
                        </div>
                    </div>

                    <button class="fab" onclick="navegar('analisar')">+</button>
                `;
            }

            if (state.page === 'analisar') {
                app.innerHTML = `
                    <div style="padding:20px">
                        <div onclick="navegar('home')" style="margin-bottom:20px; font-weight:bold; color:var(--blue)">‚Üê VOLTAR</div>
                        <h2 style="text-align:center">Analisar com IA</h2>
                        <div class="card" style="text-align:center">
                            ${!state.photo ? `
                                <div style="padding:40px 0">
                                    <button class="btn-main" onclick="document.getElementById('cam').click()">üì∏ TIRAR FOTO</button>
                                    <button class="btn-main" style="background:#6c757d; margin-top:10px" onclick="document.getElementById('gal').click()">üìÅ GALERIA</button>
                                </div>
                                <input type="file" id="cam" capture="environment" accept="image/*" style="display:none" onchange="handleFile(event)">
                                <input type="file" id="gal" accept="image/*" style="display:none" onchange="handleFile(event)">
                            ` : `
                                <img src="${state.photo}" style="width:100%; border-radius:12px; margin-bottom:20px">
                                <button class="btn-main" style="background:var(--primary)" onclick="runIA()">üöÄ ANALISAR AGORA</button>
                                <button class="btn-main" style="background:#eee; color:#333; margin-top:10px" onclick="state.photo=null; render()">TROCAR FOTO</button>
                            `}
                        </div>
                    </div>
                `;
            }

            if (state.page === 'dica') {
                app.innerHTML = `
                    <div style="padding:40px 25px; text-align:center">
                        <div style="font-size:60px">ü•ó</div>
                        <h2 style="color:var(--primary)">An√°lise Conclu√≠da!</h2>
                        <div class="card">
                            <p>Sua refei√ß√£o possui aproximadamente:</p>
                            <h1 style="font-size:48px; color:var(--blue)">${state.lastKcal} kcal</h1>
                        </div>
                        <div style="background:#e7f3ff; padding:20px; border-radius:15px; text-align:left; border-left:5px solid var(--blue)">
                            <b>üí° DICA DA NUTRI:</b>
                            <p style="margin:5px 0; font-size:14px">Sabia que mastigar cada garfada pelo menos 15 vezes ajuda seu corpo a queimar calorias de forma mais eficiente?</p>
                        </div>
                        <button class="btn-main" style="margin-top:30px" onclick="navegar('home')">VOLTAR AO DASHBOARD</button>
                    </div>
                `;
            }
        }

        function login(isReg) {
            if(isReg) state.user = document.getElementById('reg-name').value || 'Usu√°rio';
            state.isLogged = true;
            state.page = 'home';
            save();
            render();
        }

        function sair() {
            state.isLogged = false;
            state.page = 'login';
            save();
            render();
        }

        render();
    </script>
</body>
</html>
