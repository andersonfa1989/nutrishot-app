
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>NutriShot Elements</title>

  <!-- AdSense (Web) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6941311170472131" crossorigin="anonymous"></script>

  <style>
    :root { 
      --primary: #2ab573; 
      --blue-action: #2490eb; 
      --bg: #f9fafb; 
      --water: #3498db;
    }
    body { 
      margin: 0; 
      font-family: 'Segoe UI', Roboto, sans-serif; 
      background: var(--bg); 
      color: #333; 
      /* banner agora √© inline; n√£o precisa reservar espa√ßo fixo */
      padding-bottom: 0; 
      overflow-x: hidden; 
    }

    /* ===== Sidebar ===== */
    .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: #fff; z-index: 10000; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 2px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    .sidebar.active { left: 0; }
    .sidebar-header { padding: 40px 20px 20px; background: linear-gradient(135deg, var(--blue-action), var(--primary)); color: #fff; }
    .sidebar-menu { padding: 20px 0; flex-grow: 1; }
    .menu-item { padding: 15px 25px; display: flex; align-items: center; gap: 15px; cursor: pointer; font-weight: 500; transition: 0.2s; color: #444; }
    .menu-item:hover { background: #f0f7f4; color: var(--primary); }
    .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 9999; backdrop-filter: blur(2px); }
    .sidebar-overlay.active { display: block; }

    /* ===== UI ===== */
    .img-logo-principal { width: 170px; margin-bottom: 5px; } 
    .texto-logo { font-size: 24px; font-weight: 800; background: linear-gradient(to right, #2490eb, #2ab573, #f39c12); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0 0 20px; letter-spacing: -0.5px; }
    .input-nutri { width: 85%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; outline: none; }
    .input-metade { width: 40%; display: inline-block; }
    .btn-azul { width: calc(100% - 40px); background: var(--blue-action); color: #fff; border: none; padding: 18px; border-radius: 30px; margin: 10px 20px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(36,144,235,.3); }
    .footer-link { margin-top: 20px; font-size: 14px; cursor: pointer; color: #000; font-weight: 500; }
    .footer-link span { color: var(--blue-action); font-weight: 700; }
    .card { background: #fff; border-radius: 20px; padding: 20px; margin: 15px 20px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
    .card-fogo { background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; border: none; display: flex; justify-content: space-between; align-items: center; }
    .imc-info { text-align: right; background: rgba(255,255,255,0.15); padding: 8px 12px; border-radius: 12px; min-width: 80px; cursor: pointer; }
    .imc-label { font-size: 10px; opacity: 0.9; display: flex; align-items: center; justify-content: flex-end; gap: 4px; }
    .imc-status { font-size: 10px; font-weight: bold; text-transform: uppercase; margin-top: 2px; display: block; }
    .grid-7 { display: flex; justify-content: space-between; align-items: flex-end; height: 50px; margin-top: 15px; }
    .col-dia { display: flex; flex-direction: column; align-items: center; flex: 1; }
    .barra-v { width: 30px; height: 4px; background: #eee; border-radius: 2px; }
    .barra-v.active { background: #6a11cb; width: 40px; }
    .dia-txt { font-size: 10px; color: #aaa; margin-top: 5px; }

    .progress-container { width: 100%; height: 10px; background: #eee; border-radius: 10px; margin-top: 10px; overflow: hidden; }
    .progress-bar { height: 100%; background: var(--primary); transition: width 0.5s ease; }
    .progress-bar.water { background: var(--water); }

    .btn-water { background: var(--water); color: #fff; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
    .selector-objetivo { display: flex; gap: 10px; margin: 0 20px 15px; }
    .opt-obj { flex: 1; padding: 12px; border-radius: 12px; border: 2px solid #eee; background: #fff; text-align: center; font-weight: bold; cursor: pointer; font-size: 13px; }
    .opt-obj.active { border-color: var(--primary); background: #f0fff7; color: var(--primary); }

    .dica-container { min-height: 85vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 30px; background: radial-gradient(circle at top right, #f0fff7, #ffffff); text-align: center; }
    .dica-texto-grande { font-size: 30px; font-weight: 800; line-height: 1.2; color: #222; margin: 30px 0; }
    .btn-principal { width: calc(100% - 40px); background: linear-gradient(to right, #667eea, #764ba2); color: #fff; border: none; padding: 18px; border-radius: 30px; margin: 10px 20px; font-size: 18px; font-weight: bold; cursor: pointer; }
    .btn-loja { background: #2ab573; color: #fff; border: none; padding: 15px; border-radius: 12px; width: calc(100% - 40px); margin: 0 20px; font-weight: bold; font-size: 14px; cursor: pointer; }
    .btn-outline { background: transparent; color: #666; border: 1px solid #ddd; padding: 12px; border-radius: 12px; width: 100%; cursor: pointer; font-weight: 500; }

    .fab { position: fixed; bottom: 30px; right: 20px; width: 65px; height: 65px; background: #000; color: #fff; border-radius: 50%; font-size: 30px; border: none; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 99; }

    #img-preview { width: 100%; max-height: 200px; object-fit: cover; border-radius: 12px; margin-bottom: 15px; border: 1px solid #ddd; }

    /* --- RODAP√â COM BANNER MENOR (INLINE, N√ÉO FIXO) --- */
    .ad-footer { 
      width: 100%; 
      background: #fff; border-top: 1px solid #eee; 
      height: 65px; display: flex; flex-direction: column; align-items: center; justify-content: center;
      margin-top: 10px;
    }
    .adbox { width: 320px; height: 50px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
    .adbox ins.adsbygoogle { display: inline-block !important; width: 320px !important; height: 50px !important; }
    .ad-footer small { font-size: 9px; color: #aaa; margin-top: 2px; text-transform: uppercase; }

    /* Simulador (fallback) */
    .ads-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 99999; flex-direction: column; align-items: center; justify-content: center; color: #fff; }
    .bar-container { width: 70%; height: 8px; background: #333; border-radius: 10px; margin-top: 25px; overflow: hidden; }
    #bar-progress { width: 0%; height: 100%; background: #2ab573; transition: width 0.1s linear; }

    /* Progresso semanal */
    .week-bars { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-top: 20px; }
    .week-col { display:flex; flex-direction:column; align-items:center; }
    .week-bar  { width: 14px; height: 80px; background:#eee; border-radius: 8px; position: relative; overflow: hidden; }
    .week-fill { position:absolute; bottom:0; left:0; width:100%; background: var(--primary); }
    .week-day  { font-size: 10px; color:#888; margin-top:8px; }
    .week-legend { font-size:12px; color:#666; margin-top:10px; text-align:center; }
  </style>
</head>
<body>

  <!-- Overlay ‚Äúprocessando‚Äù (fallback Web) -->
  <div id="ads-overlay" class="ads-overlay">
    <div id="ad-text" style="font-size: 18px; font-weight: bold;">Analisando...</div>
    <div class="bar-container"><div id="bar-progress"></div></div>
  </div>

  <!-- Aplica√ß√£o -->
  <div id="app"></div>

  <!-- Banner Web inline: aparece ao rolar at√© o fim -->
  <div id="ad-footer-web" class="ad-footer">
    <div class="adbox">
      <ins class="adsbygoogle"
           style="display:inline-block;width:320px;height:50px"
           data-ad-client="ca-pub-6941311170472131"
           data-ad-slot="2257554053"
           data-full-width-responsive="false"></ins>
    </div>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    <small>Publicidade</small>
  </div>

  <script>
    const LOGO_URL = "icone-512.png";
    const isNative = !!(window?.Capacitor?.isNativePlatform?.() && window.Capacitor.isNativePlatform()) || !!window.cordova;

    // IDs AdMob (substituir pelos seus)
    const ADMOB = {
      APP_ID: 'ADMOB_APP_ID',
      BANNER_ID: 'ADMOB_BANNER_ID',
      INTERSTITIAL_ID: 'ADMOB_INTERSTITIAL_ID',
      REWARDED_ID: 'ADMOB_REWARDED_ID'
    };

    /* ========================= Estado ========================= */
    const SUPLEMENTOS = {
      ganho: [
        { nome:"Creatina Growth 100g", foto:"creatina-100g.png", link:"https://amzn.to/4b47g9o" },
        { nome:"Whey Chocolate", foto:"wey-choco.png", link:"https://amzn.to/3LjWMIB" },
        { nome:"Whey Morango", foto:"wey-moran.png", link:"https://amzn.to/4sPsdvg" },
        { nome:"Whey Creme", foto:"wey-creme.png", link:"https://amzn.to/4qq9ODl" },
        { nome:"Gainer Chocolate", foto:"Hipercal√≥rico-choco.png", link:"https://amzn.to/4qpZKKC" },
        { nome:"Gainer Cookies", foto:"Hipercal√≥rico-cooki.png", link:"https://amzn.to/4bC9A7C" }
      ],
      perda: [
        { nome:"Psyllium C√°psulas", foto:"Psyllium-caps.png", link:"https://amzn.to/4sBfMmq" },
        { nome:"Psyllium em P√≥", foto:"Psyllium-po.png", link:"https://amzn.to/3YINEAk" },
        { nome:"Ultra Burn Termog√™nico", foto:"termog.png", link:"https://amzn.to/4b5phUQ" },
        { nome:"L-Carnitina 2000mg", foto:"l-creat2000.png", link:"https://amzn.to/4bBHcCw" },
        { nome:"L-Carnitina 1000mg", foto:"l-creat1000mg.png", link:"https://amzn.to/3LJAv6S" }
      ]
    };

    let estado = JSON.parse(localStorage.getItem('nutrishot_v5')) || {
      logado: false, tela: 'cadastro', nomeUsuario: 'Usu√°rio', objetivo: 'perda',
      peso: 70, altura: 170, imc: 24.2, classification: 'Normal',
      calorias: 0, prot: 0, carb: 0, gord: 0, aguaAtual: 0, historico: [],
      sequencia: 1, ultimoAcesso: new Date().toDateString(),
      tempRefeicao: 'Almo√ßo', fotoSelecionada: null, ultimoResultado: null,
      ultimoReset: null
    };

    function salvar(){ localStorage.setItem('nutrishot_v5', JSON.stringify(estado)); }
    function navegar(t){ estado.tela = t; salvar(); render(); window.scrollTo(0,0); }

    function toggleMenu(){
      const s = document.getElementById('sidebar');
      const o = document.getElementById('sidebar-overlay');
      if(s && o){ s.classList.toggle('active'); o.classList.toggle('active'); }
    }
    function menuNav(t){ toggleMenu(); navegar(t); }

    function infoIMC(peso, altura){
      const m = altura/100; const imc = (peso/(m*m)).toFixed(1);
      let cls = imc < 18.5 ? "Magreza" : imc < 25 ? "Normal" : imc < 30 ? "Sobrepeso" : imc < 35 ? "Obesidade I" : imc < 40 ? "Obesidade II" : "M√≥rbida";
      return { valor: imc, texto: cls };
    }

    function verificarSequencia(){
      const hoje = new Date().toDateString();
      if (estado.ultimoAcesso !== hoje) {
        const ontem = new Date(); ontem.setDate(ontem.getDate()-1);
        estado.sequencia = (estado.ultimoAcesso === ontem.toDateString()) ? estado.sequencia + 1 : 1;
        estado.ultimoAcesso = hoje; salvar();
      }
    }

    function editarMedidas(){
      const p = prompt("Digite seu peso atual (kg):", estado.peso);
      const a = prompt("Digite sua altura atual (cm):", estado.altura);
      if(p && a){
        estado.peso = parseFloat(p); estado.altura = parseFloat(a);
        const r = infoIMC(estado.peso, estado.altura);
        estado.imc = r.valor; estado.classification = r.texto; salvar(); render();
      }
    }

    function validarEEntrar(){
      const email = document.getElementById('email-f')?.value || '';
      if(email.length < 3){ alert("Preencha os campos!"); return; }
      if(document.getElementById('nome-f')){ 
        estado.nomeUsuario = document.getElementById('nome-f').value || 'Usu√°rio';
        estado.peso = parseFloat(document.getElementById('peso-f').value) || 70;
        estado.altura = parseFloat(document.getElementById('altura-f').value) || 170;
        const r = infoIMC(estado.peso, estado.altura); estado.imc = r.valor; estado.classification = r.texto;
      }
      estado.logado = true; estado.tela = 'home'; verificarSequencia(); salvar(); render();
    }

    function beberAgua(){ estado.aguaAtual += 250; salvar(); render(); }

    /* ---------- Simulador (fallback Web) ---------- */
    function rodarAnuncio(texto, cb){
      const ov = document.getElementById('ads-overlay');
      const bar = document.getElementById('bar-progress');
      document.getElementById('ad-text').innerText = texto;
      ov.style.display = 'flex';
      let p = 0;
      const it = setInterval(()=>{
        p += 5; bar.style.width = p+'%';
        if(p >= 100){ clearInterval(it); ov.style.display='none'; bar.style.width='0%'; cb && cb(); }
      }, 60);
    }

    function prepararFoto(e){
      const f = e.target.files[0];
      if(f){
        const r = new FileReader();
        r.onload = ev => { estado.fotoSelecionada = ev.target.result; render(); };
        r.readAsDataURL(f);
      }
    }

    /* =============== IA (backend) =============== */
    async function analisarRefeicaoPorIA(){
      try{
        const res = await fetch('YOUR_BACKEND_URL/analyze-food', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ imageBase64: estado.fotoSelecionada })
        });
        if(!res.ok) throw new Error('Falha na IA');
        return await res.json(); // { kcal, prot, carb, gord }
      }catch(e){
        console.warn('Falha IA, fallback rand√¥mico', e);
        const cal = Math.floor(Math.random()*200 + 350);
        return { kcal: cal, prot: Math.floor(cal*0.05), carb: Math.floor(cal*0.12), gord: Math.floor(cal*0.03) };
      }
    }

    async function confirmarAnalise(){
      await showInterstitialReal().catch(()=>{});
      rodarAnuncio("IA analisando nutrientes...", async ()=>{
        const r = await analisarRefeicaoPorIA();
        estado.calorias += r.kcal; estado.prot += r.prot; estado.carb += r.carb; estado.gord += r.gord;
        estado.historico.unshift({ tipo: estado.tempRefeicao, cal: r.kcal, data: new Date().toDateString() });
        estado.ultimoResultado = { tipo: estado.tempRefeicao, cal: r.kcal };
        estado.fotoSelecionada = null; salvar(); navegar('resultado_analise');
      });
    }

    /* ===== Plano alimentar autom√°tico ===== */
    function getImcFaixa(imc){
      if (imc < 18.5) return 'baixo';
      if (imc < 25) return 'normal';
      if (imc < 30) return 'sobrepeso';
      if (imc < 35) return 'obesidade1';
      if (imc < 40) return 'obesidade2';
      return 'obesidade3';
    }

    function calcularAlvoCalorico(objetivo, imc, peso){
      const f = getImcFaixa(imc); let kk;
      if (objetivo === 'perda'){
        if (f === 'obesidade2' || f === 'obesidade3') kk = 22;
        else if (f === 'sobrepeso' || f === 'obesidade1') kk = 24;
        else kk = 26;
      } else { // ganho
        if (f === 'baixo') kk = 38;
        else if (f === 'normal') kk = 34;
        else kk = 30;
      }
      return Math.round(Math.max(1200, Math.min(4200, kk*peso)));
    }

    function calcularMacros(objetivo, imc, peso, kcal){
      const f = getImcFaixa(imc); let protKg, gordKg;
      if (objetivo === 'perda'){ protKg = (f === 'sobrepeso' || f.includes('obesidade')) ? 2.0 : 1.6; gordKg = 0.8; }
      else { protKg = 1.8; gordKg = 1.0; }
      const prot = Math.round(protKg*peso), gord = Math.round(gordKg*peso);
      const carb = Math.max(0, Math.round((kcal - (prot*4 + gord*9)) / 4));
      return { prot, carb, gord };
    }

    function gerarSugestoesRefeicoes(objetivo, kcalDia, macros){
      const dist = [0.20, 0.35, 0.20, 0.25];
      const nomes = ['Caf√© da manh√£', 'Almo√ßo', 'Lanche', 'Jantar'];
      const perda = [
        ['Ovos mexidos (2) + p√£o integral (1) + fruta', 'Iogurte natural (170g) + aveia (15g)'],
        ['Frango (120g) + arroz integral (3 c.s.) + feij√£o (1/2 concha) + salada', 'Peixe (120g) + pur√™ de ab√≥bora (120g) + legumes'],
        ['Iogurte + chia (10g) + castanhas (3 un)', 'Shake whey + √°gua + 1 fruta pequena'],
        ['Carne magra (100g) + batata doce (120g) + br√≥colis', 'Omelete (3 ovos) + salada + azeite (1 c.ch√°)']
      ];
      const ganho = [
        ['Ovos (3) + p√£o integral (2) + fruta + pasta de amendoim (1 c.s.)', 'Iogurte grego + granola (30g) + banana'],
        ['Frango/Patinho (150g) + arroz (5 c.s.) + feij√£o (1 concha) + salada + azeite (1 c.s.)', 'Peixe (150g) + pur√™ batata (180g) + legumes + azeite'],
        ['Whey + leite + banana + aveia (30g)', 'Sandu√≠che integral com atum/queijo e salada'],
        ['Carne magra (150g) + massa integral (120g coz.) + legumes', 'Omelete (4 ovos) + arroz (3 c.s.) + salada']
      ];
      const base = objetivo === 'perda' ? perda : ganho;

      return dist.map((p, i) => {
        const kcal = Math.round(kcalDia * p);
        const prot = Math.round(macros.prot * p);
        const carb = Math.round(macros.carb * p);
        const gord = Math.round(macros.gord * p);
        const opcoes = base[i];
        return { nome: nomes[i], kcal, prot, carb, gord, sugestao: opcoes[(kcal + prot + i*3) % opcoes.length] };
      });
    }

    function gerarPlanoAuto(){
      const obj = estado.objetivo, imc = parseFloat(estado.imc), peso = parseFloat(estado.peso);
      const kcal = calcularAlvoCalorico(obj, imc, peso);
      const macros = calcularMacros(obj, imc, peso, kcal);
      const refeicoes = gerarSugestoesRefeicoes(obj, kcal, macros);
      const agua = Math.round(peso * 35);
      return { kcal, ...macros, refeicoes, agua };
    }

    function montarTextoPlanoWhats(plano){
      const { kcal, prot, carb, gord, refeicoes, agua } = plano;
      const header = `*PLANO ${estado.objetivo === 'perda' ? 'EMAGRECER' : 'GANHO DE MASSA'}* (${kcal} kcal/dia)%0A` +
                     `IMC: ${estado.imc} (${estado.classification}) ‚Ä¢ Peso: ${estado.peso}kg%0A` +
                     `Macros/dia ‚Üí Prot: ${prot}g ‚Ä¢ Carb: ${carb}g ‚Ä¢ Gord: ${gord}g%0A%0A` +
                     `*Refei√ß√µes sugeridas*:%0A`;
      const linhas = refeicoes.map(r => `‚Ä¢ ${r.nome} (${r.kcal} kcal) ‚Üí P:${r.prot}g C:${r.carb}g G:${r.gord}g%0A  - ${r.sugestao}`).join('%0A');
      const rodape = `%0A%0Aüíß √Ågua/dia: ${agua} ml%0A_Gerado pela IA NutriShot_`;
      return header + linhas + rodape;
    }

    function gerarPlanoWhatsApp(){
      const plano = gerarPlanoAuto();
      const texto = montarTextoPlanoWhats(plano);
      window.open(`https://wa.me/?text=${texto}`, '_blank');
    }

    /* ===== Progresso semanal ===== */
    function calcularProgressoSemanal(){
      const dias = [0,0,0,0,0,0,0], hoje = new Date();
      (estado.historico||[]).forEach(i=>{
        if(!i.data) return;
        const d = new Date(i.data);
        const diff = Math.floor((hoje - d)/86400000);
        if(diff>=0 && diff<7){ const idx = d.getDay()===0 ? 6 : d.getDay()-1; dias[idx]+=i.cal; }
      });
      const meta = 2577; return dias.map(v=> Math.min((v/meta)*100, 100));
    }

    /* ===== Reset di√°rio preservando a semana ===== */
    function verificarResetDiario(){
      const hoje = new Date().toDateString();
      if(!estado.ultimoReset || estado.ultimoReset !== hoje){
        estado.calorias=0; estado.prot=0; estado.carb=0; estado.gord=0; estado.aguaAtual=0;
        estado.historico = (estado.historico||[]).filter(h=>{
          if(!h?.data) return false;
          const diff = Math.floor((new Date() - new Date(h.data))/86400000);
          return diff < 7;
        });
        estado.ultimoReset = hoje; salvar();
      }
    }

    /* ================== AdMob nativo: banner s√≥ na tela PROGRESSO ================== */
    let admobReady = false;
    let nativeBannerShown = false;

    async function initAdMobIfAvailable(){
      try{
        const cap = window?.Capacitor;
        const CapAdMob = cap?.Plugins?.AdMob;
        const CordovaAdmobPlus = window?.admob;

        if (CapAdMob?.initialize){
          await CapAdMob.initialize({ requestTrackingAuthorization: true, initializeForTesting: false });
          await CapAdMob.prepareInterstitial({ adId: ADMOB.INTERSTITIAL_ID });
          await CapAdMob.prepareRewardVideoAd({ adId: ADMOB.REWARDED_ID });
          admobReady = true; return;
        }
        if (CordovaAdmobPlus?.interstitial){
          window.admob.interstitial.load({ id:{android:ADMOB.INTERSTITIAL_ID} });
          window.admob.rewardVideo.load({ id:{android:ADMOB.REWARDED_ID} });
          admobReady = true; return;
        }
      }catch(e){ console.warn('AdMob nativo n√£o inicializado:', e); }
    }

    async function showNativeBanner(){
      if(!admobReady || nativeBannerShown) return;
      // Esconde banner Web inline para evitar duplicidade
      const webFooter = document.getElementById('ad-footer-web');
      if(webFooter) webFooter.style.display = 'none';

      const CapAdMob = window?.Capacitor?.Plugins?.AdMob;
      try{
        if(CapAdMob?.showBanner){
          await CapAdMob.showBanner({ adId: ADMOB.BANNER_ID, adSize:'BANNER', position:'BOTTOM_CENTER' });
          nativeBannerShown = true; return;
        }
      }catch(e){ console.warn('Falha showBanner (Capacitor):', e); }

      try{
        if(window?.admob?.banner?.show){
          await window.admob.banner.show({ id:{android:ADMOB.BANNER_ID}, size:'BANNER', position:'BOTTOM_CENTER' });
          nativeBannerShown = true; return;
        }
      }catch(e){ console.warn('Falha showBanner (Cordova):', e); }
    }

    async function hideNativeBanner(){
      if(!admobReady || !nativeBannerShown) return;
      const CapAdMob = window?.Capacitor?.Plugins?.AdMob;
      try{ if(CapAdMob?.hideBanner) await CapAdMob.hideBanner(); }catch(e){ console.warn('hideBanner (Capacitor):', e); }
      try{ if(window?.admob?.banner?.hide) await window.admob.banner.hide(); }catch(e){ console.warn('hideBanner (Cordova):', e); }
      nativeBannerShown = false;
      const webFooter = document.getElementById('ad-footer-web');
      if(webFooter) webFooter.style.display = '';
    }

    async function syncBannerWithView(){
      const isProgresso = (estado?.tela === 'progresso');
      if(!isNative || !admobReady){
        const webFooter = document.getElementById('ad-footer-web');
        if(webFooter) webFooter.style.display = '';
        return;
      }
      if(isProgresso) await showNativeBanner(); else await hideNativeBanner();
    }

    // Interstitial e Rewarded (com fallback Web)
    async function showInterstitialReal(){
      if(!admobReady) return Promise.reject('AdMob off');
      const CapAdMob = window?.Capacitor?.Plugins?.AdMob;
      if(CapAdMob?.showInterstitial){
        await CapAdMob.showInterstitial();
        await CapAdMob.prepareInterstitial({ adId: ADMOB.INTERSTITIAL_ID });
        return;
      }
      if(window?.admob?.interstitial?.show){
        await window.admob.interstitial.show();
        await window.admob.interstitial.load({ id:{android:ADMOB.INTERSTITIAL_ID} });
        return;
      }
      return Promise.reject('Sem provedor');
    }

    async function showRewardedReal(onReward){
      if(!admobReady){
        return new Promise(res => rodarAnuncio('An√∫ncio de recompensa (simulado)...', ()=>{ onReward && onReward({value:1,type:'simulado'}); res(); }));
      }
      const CapAdMob = window?.Capacitor?.Plugins?.AdMob;
      if(CapAdMob?.showRewardVideoAd){
        const { value, type } = await CapAdMob.showRewardVideoAd();
        onReward && onReward({ value, type });
        await CapAdMob.prepareRewardVideoAd({ adId: ADMOB.REWARDED_ID });
        return;
      }
      if(window?.admob?.rewardVideo?.show){
        await window.admob.rewardVideo.show();
        onReward && onReward({ value:1, type:'reward' });
        await window.admob.rewardVideo.load({ id:{android:ADMOB_REWARDED_ID} });
        return;
      }
    }

    if(isNative){
      document.addEventListener('deviceready', initAdMobIfAvailable);
      window.addEventListener('load', initAdMobIfAvailable);
    }
