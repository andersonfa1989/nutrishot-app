<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>NutriShot Elements Ultra</title>
    
    <style>
        :root {
            --primary: #2ab573;
            --blue: #2490eb;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
            --text-dark: #2d3436;
            --danger: #ff4757;
        }

        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); 
            color: var(--text-dark);
            -webkit-tap-highlight-color: transparent;
        }

        /* Container do An√∫ncio Overlay (AdMob) */
        .ad-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 99999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-align: center;
        }

        .progress-container {
            width: 80%;
            height: 4px;
            background: #333;
            border-radius: 10px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--primary);
            transition: width 0.1s linear;
        }

        /* Estilos da Interface */
        .container { padding: 20px; padding-top: 40px; }
        .card { 
            background: var(--card-bg); 
            border-radius: 24px; 
            padding: 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); 
        }
        
        .header-logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(45deg, var(--blue), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        .btn-main {
            background: var(--blue);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 16px;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-main:active { transform: scale(0.98); }
        
        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #f1f1f1;
        }
    </style>
</head>
<body>
    <div id="ad-overlay" class="ad-overlay">
        <h3 id="ad-label">Sincronizando com AdMob...</h3>
        <div class="progress-container">
            <div id="ad-progress-bar" class="progress-bar"></div>
        </div>
    </div>

    <div class="container" id="main-view">
        </div>

    <script>
        /* CONFIGURA√á√ÉO DOS IDS FORNECIDOS */
        const ADMOB_CONFIG = {
            APP_ID: "ca-app-pub-6941311170472131~1202658535",
            BANNER: "ca-app-pub-6941311170472131/2257554053",
            INTERSTITIAL: "ca-app-pub-6941311170472131/2273031775",
            REWARDED: "ca-app-pub-6941311170472131/4221550021"
        };
        /* SISTEMA DE PERSIST√äNCIA */
        const Storage = {
            get: () => {
                const data = localStorage.getItem('nutrishot_data_v1');
                return data ? JSON.parse(data) : {
                    caloriasHoje: 0,
                    historico: [], // Array de objetos {data: '', hora: '', cal: 0, nome: ''}
                    ultimaData: new Date().toDateString(),
                    perfil: { nome: "Isaac" }
                };
            },
            save: (dados) => {
                localStorage.setItem('nutrishot_data_v1', JSON.stringify(dados));
            }
        };

        let appData = Storage.get();

        /* VERIFICADOR DE RESET DI√ÅRIO (Zera calorias, mant√©m hist√≥rico) */
        function checkDailyReset() {
            const hoje = new Date().toDateString();
            if (appData.ultimaData !== hoje) {
                appData.caloriasHoje = 0;
                appData.ultimaData = hoje;
                Storage.save(appData);
            }
        }
        /* GERENCIADOR DE AN√öNCIOS */
        function processarAnuncio(tipo, acaoSucesso) {
            const overlay = document.getElementById('ad-overlay');
            const bar = document.getElementById('ad-progress-bar');
            const label = document.getElementById('ad-label');

            label.innerText = tipo === 'REWARDED' ? "Desbloqueando Conte√∫do..." : "Processando Dados...";
            overlay.style.display = 'flex';

            // Comandos para o WebView do Android detectar a inten√ß√£o de exibir AdMob
            try {
                if (window.Android) {
                    if (tipo === 'INTERSTITIAL') window.Android.showInterstitial();
                    if (tipo === 'REWARDED') window.Android.showRewarded();
                }
            } catch (e) { console.warn("Ambiente web: Simulando AdMob"); }

            let progresso = 0;
            const intervalo = setInterval(() => {
                progresso += 4;
                bar.style.width = progresso + '%';

                if (progresso >= 100) {
                    clearInterval(intervalo);
                    overlay.style.display = 'none';
                    bar.style.width = '0%';
                    acaoSucesso(); // Executa a fun√ß√£o do app ap√≥s o an√∫ncio
                }
            }, 80); // Simula o tempo de carregamento/exibi√ß√£o
        }
        /* NAVEGA√á√ÉO E L√ìGICA DE NEG√ìCIO */
        function navegar(tela) {
            window.currentScreen = tela;
            render();
        }

        function adicionarRefeicao(nome) {
            // Exibe an√∫ncio Intersticial antes de mostrar o resultado
            processarAnuncio('INTERSTITIAL', () => {
                const caloriasGeradas = Math.floor(Math.random() * (600 - 200 + 1)) + 200;
                
                const novaEntrada = {
                    id: Date.now(),
                    nome: nome,
                    cal: caloriasGeradas,
                    data: new Date().toLocaleDateString('pt-BR'),
                    hora: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})
                };

                appData.caloriasHoje += caloriasGeradas;
                appData.historico.unshift(novaEntrada); // Adiciona no in√≠cio da lista
                Storage.save(appData);
                navegar('home');
            });
        }
        function render() {
            const root = document.getElementById('main-view');
            
            if (!window.currentScreen || window.currentScreen === 'home') {
                root.innerHTML = `
                    <div class="header-logo">NutriShot Pro</div>
                    
                    <div class="card" style="background: linear-gradient(135deg, var(--primary), #20965f); color: white;">
                        <small>Total de Hoje</small>
                        <h1 style="margin: 5px 0 0 0; font-size: 36px;">${appData.caloriasHoje} <span style="font-size: 18px;">kcal</span></h1>
                    </div>

                    <button class="btn-main" onclick="adicionarRefeicao('Refei√ß√£o R√°pida')">üì∏ ANALISAR REFEI√á√ÉO</button>
                    
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn-main" style="background: #6c757d; flex: 1;" onclick="navegar('historico')">üìã HIST√ìRICO</button>
                        <button class="btn-main" style="background: var(--primary); flex: 1;" onclick="processarAnuncio('REWARDED', () => alert('Dica: Prote√≠nas ajudam na saciedade!'))">üí° DICA AD</button>
                    </div>

                    <div style="margin-top: 30px;">
                        <h3>√öltimas Atividades</h3>
                        ${appData.historico.slice(0, 3).map(i => `
                            <div class="history-item">
                                <span>${i.nome} <br><small style="color: #888">${i.hora}</small></span>
                                <b style="color: var(--primary)">+${i.cal} kcal</b>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else if (window.currentScreen === 'historico') {
                // Agrupando por data para uma vis√£o limpa
                const grupos = appData.historico.reduce((acc, item) => {
                    acc[item.data] = acc[item.data] || [];
                    acc[item.data].push(item);
                    return acc;
                }, {});

                root.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                        <button onclick="navegar('home')" style="border:none; background:none; font-size: 24px; cursor:pointer;">‚Üê</button>
                        <h2 style="margin:0">Meu Hist√≥rico</h2>
                    </div>

                    ${Object.keys(grupos).length === 0 ? '<p>Nenhum registro encontrado.</p>' : ''}

                    ${Object.keys(grupos).map(data => `
                        <div style="margin: 20px 0 10px 5px; font-weight: bold; color: var(--blue);">${data}</div>
                        <div class="card">
                            ${grupos[data].map(i => `
                                <div class="history-item">
                                    <span>${i.nome} <small>(${i.hora})</small></span>
                                    <b>${i.cal} kcal</b>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                    
                    <button class="btn-main" style="background: var(--danger); margin-top: 40px;" 
                            onclick="if(confirm('Limpar tudo?')){appData.historico=[]; Storage.save(appData); navegar('historico')}">
                        LIMPAR TODO O HIST√ìRICO
                    </button>
                `;
            }
        }

        // Inicializa√ß√£o
        checkDailyReset();
        render();
    </script>
</body>
</html>
